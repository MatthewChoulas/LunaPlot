<!DOCTYPE html>
<html>
    <head>
        <title>Arduino Web Plotter Change</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.js" integrity="sha512-VJ6+sp2E5rFQk05caiXXzQd1wBABpjEj1r5kMiLmGAAgwPItw1YpqsCCBtq8Yr1x6C49/mTpRdXtq8O2RcZhlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>

    <body>
        <div class="navbar"><span>Arduino Web Plotter</span></div>
        <div id="sample"></div>
        <div class = "wrapper">
            <div id="chart"></div>
        </div>


        <script>
            const start = Date.now();
            const xrange = 5000;
            var xmin = 0;
            var xmax = xrange;

            var traces = [];

            Plotly.plot('chart', [{
                y: [0],
                type: "line"
                
            }]);


            var socket = io();

            socket.on('data', function(data){
                document.getElementById('sample').innerHTML = data;
                plotData(data);
            });

            function plotData(data) {
                data = parseInt(data.slice(6), 10);
                var time = Date.now() - start;

                value = parseInt(data.slice(6), 10);

                /*
                data = data.split(" ");
                data = data.map((element,index) => {
                    element = element.split(":");
                    element[1] = parseInt(element[1]);
                    return element;
                });
                
               
                
                

                for (let i in data) {
                    var trace = data[i];
                    if (traces.includes(trace[0]) == false) {
                        console.log('hi');
                        traces.push(trace[0]);
                        Plotly.addTrace('chart', [{x: [0], y: [0], name: trace[0], type:"line", mode: "lines+markers"}]);
                    }
                }
        
                
                
                xValues = Array(data.length).fill([0]);
                yValues = data.map((trace) => {
                    return [trace[1]];
                });
                traceIndexes = Array(data.length).fill(0).map((x, y) => x + y);
                console.log(traceIndexes);

                Plotly.extendTraces('chart', {
                    x:xValues, 
                    y:yValues
                }, traceIndexes, 500);
                */
               /*
                var first = true;

                if (first) {
                    first = false;
                    Plotly.addTraces('chart', [{x: [0], y: [0], name: trace[0], type:"line", mode: "lines+markers"}]);
                }
                */
                console.log(value);

                Plotly.extendTraces('chart', {
                    y:[[value]]}
                    , [0], 500);


                /*
                 
                if (time > xmax) {
                    xmax += 10*(time-xmax);
                    xmin = xmax-xrange;
                    
                    Plotly.relayout('chart', {
                        xaxis: {
                            range: [xmin, xmax]
                        }
                    })
                }
                */
                
                
            }
        </script>
    </body>
</html>